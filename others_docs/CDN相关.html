<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CDN相关 | hhltd的个人博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="前端开发 hhltd的个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.c36be9e9.js" as="script"><link rel="preload" href="/assets/js/2.34235d8e.js" as="script"><link rel="preload" href="/assets/js/5.d117c289.js" as="script"><link rel="prefetch" href="/assets/js/10.6ce8a8cb.js"><link rel="prefetch" href="/assets/js/11.624e2edb.js"><link rel="prefetch" href="/assets/js/12.e7e1a653.js"><link rel="prefetch" href="/assets/js/13.410548ad.js"><link rel="prefetch" href="/assets/js/14.b5893008.js"><link rel="prefetch" href="/assets/js/15.2d052b5f.js"><link rel="prefetch" href="/assets/js/16.c2f7e181.js"><link rel="prefetch" href="/assets/js/17.6b15aa38.js"><link rel="prefetch" href="/assets/js/18.cf1cb7f5.js"><link rel="prefetch" href="/assets/js/19.d392b7a9.js"><link rel="prefetch" href="/assets/js/20.9732a725.js"><link rel="prefetch" href="/assets/js/3.2f02bfbf.js"><link rel="prefetch" href="/assets/js/4.f8365012.js"><link rel="prefetch" href="/assets/js/6.6b673022.js"><link rel="prefetch" href="/assets/js/7.0b9b5fee.js"><link rel="prefetch" href="/assets/js/8.b011d26d.js"><link rel="prefetch" href="/assets/js/9.e7cae791.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="hhltd的个人博客" class="logo"> <span class="site-name can-hide">hhltd的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/js_docs/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/css_docs/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue_docs/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/node_docs/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/others_docs/" class="nav-link router-link-active">
  日常
</a></div><div class="nav-item"><a href="https://github.com/hhltd/hhltd.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/js_docs/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/css_docs/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue_docs/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/node_docs/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/others_docs/" class="nav-link router-link-active">
  日常
</a></div><div class="nav-item"><a href="https://github.com/hhltd/hhltd.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/others_docs/CDN相关.html" class="active sidebar-link">CDN相关</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cdn相关"><a href="#cdn相关" class="header-anchor">#</a> CDN相关</h1> <p>在校招述职中, 提到了cdn相关的知识, 一直以来对cdn相关的知识都是一知半解, 停留在面试八股的层面, 借此机会彻底梳理一下</p> <blockquote><p>CDN的全称是Content Delivery Network，即内容分发网络。由于CDN是为加快网络访问速度而被优化的网络覆盖层，因此被形象地称为“网络加速器”。</p></blockquote> <h4 id="cdn简介"><a href="#cdn简介" class="header-anchor">#</a> CDN简介</h4> <p>cdn的实现思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节, 使内容传输更快、更稳定</p> <ol><li>实现方法:</li></ol> <p>通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络, CDN系统能够实时地根据<strong>网络流量</strong>和各节点的<strong>连接和负载</strong>状况以及到用户的<strong>距离和响应时间</strong>等综合信息将用户的请求重新导向离用户最近的服务节点上, 加快访问速度</p> <ol start="2"><li>目的和优势:</li></ol> <p>使用户可就近取得所需内容，解决Internet网络拥挤的状况，提高用户访问网站的响应速度</p> <ul><li>CDN节点解决了跨运营商和跨地域访问的问题，访问延时大大降低</li> <li>大部分请求在CDN边缘节点完成，CDN起到了分流作用，减轻了源站的负载</li></ul> <h4 id="cdn的基本流程"><a href="#cdn的基本流程" class="header-anchor">#</a> CDN的基本流程</h4> <p><img src="/assets/img/cdn.e3656d8a.png" alt="" title=":size=613x561"></p> <p>上图展示了使用cdn后的访问资源的流程, 首先我们来看一下不使用cdn访问资源的过程是怎样的</p> <ol><li>用户输入要访问资源的域名</li> <li>浏览器向本地dns域名解析服务器请求解析该域名</li> <li>本地dns服务器如果缓存了这个域名, 直接返回给用户
如果没有缓存该域名, 以递归的方式向整个dns系统请求解析, 将结果反馈给用户</li> <li>浏览器获得域名解析的结果, 即ip地址, 向服务器发起请求</li> <li>服务器将请求结果返回给用户</li></ol> <p>接下来看一下使用的cdn之后的结果</p> <ol><li>首先访问本地的dns, 如果没有命中, 继续递归或者迭代查找, 直到命中拿到对应的ip地址。</li> <li>拿到对应的ip地址之后服务器端发送请求到目的地址, 注意这里返回的不直接是cdn服务器的ip地址, 而是全局负载均衡系统的ip地址</li> <li>全局负载均衡系统会根据客户端的ip地址和请求的url和相应的区域负载均衡系统通信</li> <li>区域负载均衡系统拿着这两个东西获取距离客户端最近且有相应资源的cdn缓存服务器的地址, 返回给全局负载均衡系统</li> <li>全局负载均衡系统返回确定的cdn缓存服务器的地址给客户端</li> <li>客户端请求缓存服务器上的文件</li></ol> <p>简单来说, 其实cdn就是个放服务端资源的一个仓库, 康师傅的泡面如果不是有家门口的小卖部, 我们就得去人家的工厂门口拿, 有了小卖部, 我们只需要去一个卖康师傅&amp;&amp;有货的小卖部拿, 就是这个道理</p> <p>其中有一个比较重要的点</p> <ul><li>在过程1里: 这个过程中, 有一个CNAME的过程, 我们访问cdn资源的地址一般是a.cloud.com或者类似的地址, 是一个公司的访问cdn的专用地址</li> <li>但是我们用的cdn的服务却是第三方的, 即其实资源在他们的地址上比如tencent.cdn, 这时候就需要在dns查询的时候, 需要把我们访问a.cloud.com的地址映射到tencent.cdn的地址上</li> <li>然后拿着映射后的地址再去走一遍dns解析, 成功之后才获取到第三方提供的全局负载均衡系统的ip, 再继续走后面的流程</li></ul> <h4 id="cdn的作用"><a href="#cdn的作用" class="header-anchor">#</a> CDN的作用</h4> <p>cdn的作用有很多, 这里简单讲述几点</p> <ol><li>加速访问</li></ol> <p>可以使用户就近获取资源, 降低网络拥塞, 提高用户访问响应速率和命中率
还提供服务器端加速, 解决由于用户访问量大造成的服务器过载问题</p> <ol start="2"><li>跨运营商, 跨地域覆盖</li></ol> <p>CDN加速可以覆盖全球的线路, 通过和运营商合作, 部署IDC资源, 在全国骨干节点商, 合理部署cdn边缘分发存储节点, 充分利用带宽资源, 平衡源站流量</p> <ol start="3"><li>保障网络安全</li></ol> <p>负载均衡和分布式存储技术一定程度上也给网站添加了一把保护伞</p> <ol start="4"><li>异地备援</li></ol> <p>当某个服务器发生意外故障时, 系统将会调用其他临近的健康服务器节点进行服务, 进而提供接近100%的可靠性, 这就让你的网站可以做到永不宕机</p> <ol start="5"><li>节约成本, 让开发者更专注于业务本身</li></ol> <h4 id="cdn的应用场景"><a href="#cdn的应用场景" class="header-anchor">#</a> CDN的应用场景</h4> <ol><li>网站站点/应用加速</li></ol> <p>站点或者应用中大量静态资源的加速分发, 建议将站点内容进行动静分离</p> <ul><li><p>动态文件可以结合云服务器ECS</p></li> <li><p>静态资源如各类型图片、html、css、js文件等, 建议结合对象存储OSS存储海量静态资源, 可以有效加速内容加载速度, 轻松搞定网站图片、短视频等内容分发</p></li></ul> <ol start="2"><li>视音频点播/大文件下载分发加速</li></ol> <p>支持各类文件的下载、分发, 支持在线点播加速业务, 如mp4、flv视频文件或者平均单个文件大小在20M以上</p> <ul><li>主要的业务场景是视音频点播、大文件下载(如安装包下载)等, 建议搭配对象存储OSS使用, 可提升回源速度, 节约近2/3回源带宽成本</li></ul> <ol start="3"><li>视频直播加速</li></ol> <p>视频流媒体直播服务, 支持媒资存储、切片转码、访问鉴权、内容分发加速一体化解决方案</p> <ul><li>结合弹性伸缩服务, 及时调整服务器带宽, 应对突发访问流量;</li> <li>结合媒体转码服务, 享受高速稳定的并行转码, 且任务规模无缝扩展, 目前cdn直播加速已服务内部用户测试并优化</li></ul> <ol start="4"><li>移动应用加速</li></ol> <ul><li>移动APP更新文件(apk文件)分发</li> <li>移动APP内图片、页面、短视频、UGC等内容的优化加速分发</li> <li>提供httpdns服务, 避免dns劫持并获得实时精确的dns解析结果, 有效缩短用户访问时间, 提升用户体验</li></ul> <h4 id="回源"><a href="#回源" class="header-anchor">#</a> 回源</h4> <p>当cdn缓存服务器中没有符合客户端要求的资源的时候, 缓存服务器会请求上一级缓存服务器, 以此类推, 直到获取到, 最后如果还是没有, 就会回到我们自己的服务器去获取资源,
那都有哪些时候会回源呢? <strong>没有资源</strong>, <strong>资源过期</strong>, <strong>访问的资源是不缓存资源</strong>等都会导致回源, 其他情况欢迎小伙伴们补充~</p> <h4 id="cdn缓存"><a href="#cdn缓存" class="header-anchor">#</a> CDN缓存</h4> <p>缓存是用空间换时间的思路, 用多余的空间, 换取更快的访问速度</p> <ol><li>不使用cdn缓存时</li></ol> <p>所用用户直接访问源服务器</p> <p><img src="/assets/img/nocachecdn.1e5440b9.png" alt="" title=":size=482x397"></p> <ol start="2"><li>使用cdn缓存</li></ol> <p>客户端浏览器先检查是否有本地缓存是否过期</p> <p>如果过期, 则向cdn边缘节点发起请求, cdn边缘节点会检测用户请求数据的缓存是否过期, 如果cdn数据没有过期, 则直接响应用户请求, 此时一个完成http请求结束</p> <p>如果cdn数据已经过期, 那么CDN还需要向源站发出回源请求, 来拉取最新的数据</p> <p><img src="/assets/img/cachecdn.bfd05f0d.png" alt="" title=":size=505x369"></p> <h4 id="关于cdn和api之间的区别-api是否能缓存"><a href="#关于cdn和api之间的区别-api是否能缓存" class="header-anchor">#</a> 关于CDN和API之间的区别(API是否能缓存?)</h4> <blockquote><p>动态加速的对象是动态生成的网页, 动态加速一般是对针对内容(如数据库信息等)在用户与 - 源站之间建立高速通道, 通过路由优化、TCP加速等技术手段对动态内容进行加速, 降低节点到源站之间的时延, 从而大大降低了用户访问动态网页的延迟</p></blockquote> <p>其实这个问题并没有找到比较合适的解答, 下面我想说一下资料总结的一些东西</p> <ul><li>我们使用cdn的原因是, 我们经常有一些比较频繁请求且容量比较大的文件, 并且更新频率不那么高的文件, 这些文件如果我们都放在自己的服务器上, 于客户端问题在于访问时间长
于服务器端是占用服务器端的资源, 所以我们采用分布式的方式扔在cdn上</li> <li>但是API不同, 首先他常更新, 其次他多和用户信息等相关联, 并且cdn判断是否缓存是依靠url, 意味着他只能缓存get请求, 所以他的应用范围是有限的, 并且api常更新, 推送更新到所有cdn节点同样是需要耗费资源的</li> <li>所以API是不适合放在cdn上的, 但是如果你的内容是相对静态的, 不涉及和用户信息关联, 并且能在一段时间内容忍缓存, 更新不频繁, 那么也不是不能考虑</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c36be9e9.js" defer></script><script src="/assets/js/2.34235d8e.js" defer></script><script src="/assets/js/5.d117c289.js" defer></script>
  </body>
</html>
